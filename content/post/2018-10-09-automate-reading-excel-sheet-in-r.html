---
title: Automate the opening of Excel files in R
author: "Marie Vaugoyeau"
date: '2018-10-10'
slug: automate-the-opening-of-excel-files-in-r
categories:
- tips and tricks
tags:
- tips and tricks
featuredpath: "/images/featured/"
featured: "Lego.jpg"
featuredalt: "Automate the opening of Excel files in R"
linktitle: "automate-the-opening-of-excel-files-in-r"
images: 
  - /img/featured/Lego.jpg  
description : "How to automate the reading and opening of Excel file (or csv or other) in R" 
output:
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#creating-dummy-datasets">Creating dummy datasets</a></li>
<li><a href="#importing-files">Importing files</a></li>
</ul>
</div>

<p>After a long period without an article, I decided to explain how I automate the opening and reading of <code>.xlsx</code>, <code>.csv</code> or other files in R.<br />
If you have other methods or remarks, <a href="https://mvaugoyeau.netlify.com/contact/">do not hesitate to contact me</a>.</p>
<div id="creating-dummy-datasets" class="section level1">
<h1>Creating dummy datasets</h1>
<p>I decided to create dummy Excel files and then import them.</p>
<pre class="r"><code>openxlsx::write.xlsx(airquality, file = &quot;airquality.xlsx&quot;)
openxlsx::write.xlsx(iris, file = &quot;iris2.xlsx&quot;)
openxlsx::write.xlsx(Orange, file = &quot;orange.xlsx&quot;)
openxlsx::write.xlsx(mtcars, file = &quot;mtcars3.xlsx&quot;)</code></pre>
</div>
<div id="importing-files" class="section level1">
<h1>Importing files</h1>
<p>Now I’m going to re-import these files, I’ll also go further by using a regular expression (regex) to have only files that have a number at the end of their names.<br />
I am not a specialist in regular expressions. If you know more about this, I recommend the article writed in french by <a href="http://perso.ens-lyon.fr/lise.vaudor/strings-et-expressions-regulieres/">Lise Vaudor</a> but I am sure there are a lot of very good articles in english!</p>
<pre class="r"><code>library(tidyverse)

fichiers_excel &lt;-  list.files(path = here::here(&quot;content&quot;, &quot;post&quot;), full.names=TRUE) %&gt;% 
  str_subset(&quot;.xlsx&quot;) %&gt;% 
  map(openxlsx::read.xlsx) %&gt;% 
  set_names(list.files(path = here::here(&quot;content&quot;, &quot;post&quot;), full.names=TRUE) %&gt;%
              str_subset(&quot;.xlsx&quot;) %&gt;% 
              str_extract(&quot;\\w+.xlsx&quot;) %&gt;% 
              str_remove(&quot;.xlsx&quot;))

str(fichiers_excel)</code></pre>
<pre><code>## List of 4
##  $ airquality:&#39;data.frame&#39;:  153 obs. of  6 variables:
##   ..$ Ozone  : num [1:153] 41 36 12 18 NA 28 23 19 8 NA ...
##   ..$ Solar.R: num [1:153] 190 118 149 313 NA NA 299 99 19 194 ...
##   ..$ Wind   : num [1:153] 7.4 8 12.6 11.5 14.3 14.9 8.6 13.8 20.1 8.6 ...
##   ..$ Temp   : num [1:153] 67 72 74 62 56 66 65 59 61 69 ...
##   ..$ Month  : num [1:153] 5 5 5 5 5 5 5 5 5 5 ...
##   ..$ Day    : num [1:153] 1 2 3 4 5 6 7 8 9 10 ...
##  $ iris2     :&#39;data.frame&#39;:  150 obs. of  5 variables:
##   ..$ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##   ..$ Sepal.Width : num [1:150] 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##   ..$ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##   ..$ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##   ..$ Species     : chr [1:150] &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; ...
##  $ mtcars3   :&#39;data.frame&#39;:  32 obs. of  11 variables:
##   ..$ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##   ..$ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
##   ..$ disp: num [1:32] 160 160 108 258 360 ...
##   ..$ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
##   ..$ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##   ..$ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
##   ..$ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
##   ..$ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
##   ..$ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##   ..$ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
##   ..$ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...
##  $ orange    :&#39;data.frame&#39;:  35 obs. of  3 variables:
##   ..$ Tree         : chr [1:35] &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##   ..$ age          : num [1:35] 118 484 664 1004 1231 ...
##   ..$ circumference: num [1:35] 30 58 87 115 120 142 145 33 69 111 ...</code></pre>
<p>Now we only want Excel files whose name has a number at the end.</p>
<pre class="r"><code>fichiers_excel_bis &lt;-  list.files(path = here::here(&quot;content&quot;, &quot;post&quot;), full.names=TRUE) %&gt;% 
  str_subset(&quot;[0-9].xlsx&quot;) %&gt;% 
  map(openxlsx::read.xlsx) %&gt;% 
  set_names(list.files(path = here::here(&quot;content&quot;, &quot;post&quot;), full.names=TRUE) %&gt;%
              str_subset(&quot;[0-9].xlsx&quot;) %&gt;% 
              str_extract(&quot;\\w+.xlsx&quot;) %&gt;% 
              str_remove(&quot;[0-9].xlsx&quot;))

str(fichiers_excel_bis)</code></pre>
<pre><code>## List of 2
##  $ iris  :&#39;data.frame&#39;:  150 obs. of  5 variables:
##   ..$ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##   ..$ Sepal.Width : num [1:150] 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##   ..$ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##   ..$ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##   ..$ Species     : chr [1:150] &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; ...
##  $ mtcars:&#39;data.frame&#39;:  32 obs. of  11 variables:
##   ..$ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##   ..$ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
##   ..$ disp: num [1:32] 160 160 108 258 360 ...
##   ..$ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
##   ..$ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##   ..$ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
##   ..$ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
##   ..$ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
##   ..$ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##   ..$ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
##   ..$ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...</code></pre>
<p>Well I admit it, it does not represent a crazy interest but it is just to expose you the principle.<br />
Of course, it’s possible to do the same thing with <code>.csv</code> files using<code>read.csv ()</code> and putting “.csv” in regex.</p>
<p>Then you can complicate it by searching for files with specific names like the place and date of sampling or the output of measuring devices.<br />
If we take the sampling file case with names of this form “Paris20-03-2014”, “Foljuif10-04-2012”, the regular expression would be “([A-z] +) \ w + ([0 -9] {2} [: punct:] [0-9] {2} [: punct:] [0-9] {4})”.</p>
<p>Here, hoping that this article is a little useful!</p>
</div>
